<!DOCTYPE html>
<meta charset="utf-8"> 
<style type="text/css">
/* 13. Basic Styling with CSS */

/* Style the lines by removing the fill and applying a stroke */
.line {
    fill: none;
    stroke: #ffab00;
    stroke-width: 3;
}
  
.overlay {
  fill: none;
  pointer-events: all;
}

/* Style the dots by assigning a fill and stroke */
.dot {
    fill: #ffab00;
    stroke: #fff;
}
  
  .focus circle {
  fill: none;
  stroke: steelblue;
}

</style>
<body>
	<input name="goods[]"/>
<input id="button" type="submit" name="button" value="enter" onclick="a(goods);"/>
</body>

<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>


			<script> 
/*ASN CHE FANNO PARTE DI TIER 1 TODO*/
/*
				var tier1 = {
							"asns":[
									{
									"asn":7018,
									"name":"AT&T"
									},
									
									{	
									"asn":209,
									"name":"CenturyLink(formerly Level 3, Qwest, Savvis, Global Crossing, TW Telecom and Exodus) "
									},
									
									{
									"asn":3356,
									"name":"CenturyLink(formerly Level 3, Qwest, Savvis, Global Crossing, TW Telecom and Exodus)"
									},

									{	
									"asn":3549,
									"name":"CenturyLink(formerly Level 3, Qwest, Savvis, Global Crossing, TW Telecom and Exodus)"
									},

									{
									"asn":4323,
									"name":"CenturyLink(formerly Level 3, Qwest, Savvis, Global Crossing, TW Telecom and Exodus)"
									},

									{
									"asn":3320,
									"name":"Deutsche Telekom AG (ICSS)"
									},

									{	
									"asn":3257,
									"name":"GTT Communications, Inc. (formerly Tinet & nLayer"
									},

									{
									"asn":4436,
									"name":"GTT Communications, Inc. (formerly Tinet & nLayer"
									},

									{
									"asn":286,
									"name":"KPN International"
									},

									{
									"asn":6830,
									"name":"Liberty Global"
									},

									{
									"asn":2914,
									"name":"NTT Communications ( America (formerly Verio)"
									},

									{"asn":5511,
									"name":"Orange (Open Transit"},

									{"asn":3491,
									"name":"PCCW Global"},

									{"asn":1239,
									"name":"Sprint (SoftBank Group"},

									{"asn":6453,
									"name":"Tata Communications India Limited (Acquired Telegloba"},

									{"asn":6762,
									"name":"Telecom Italia Sparkle (Seabone"},

									{"asn":12956,
									"name":"Telxius"},

									{"asn":1299,
									"name":"Telia Cattier"},

									{"asn":701,
									"name":"Verizon Enterprise Solutions(formerly UUNET and XO Communications"},

									{"asn":702,
									"name":"Verizon Enterprise Solutions(formerly UUNET and XO Communications"},

									{"asn":703,
									"name":"Verizon Enterprise Solutions(formerly UUNET and XO Communications"},

									{"asn":2828,
									"name":"Verizon Enterprise Solutions(formerly UUNET and XO Communications"},

									{"asn":6461,
									"name":"Zayo Group (formerly AboveNet"}

								]
							};
							//console.log(tier1.asns[3].asn);
*/				

				function a(goods){
					//var aspath = ["3","6939","6505","27735","7049"];
					
					//var aspath = ["24","2153","38040","23969"];
					
					var aspath = goods;
					var aspathreverse = aspath.reverse();

	  				//your code here
	  				$.get("input.txt", function(data) {
	  					var i,len;

						var aspathcompleto = [];
						var height = 0;

						item = {};
						item["asn"]=aspath[0];
						item["x"]=0;
						item["y"]=height;
						aspathcompleto.push(item);


	  					for(i = 0,len = aspath.length; i<len-1; ++i){
	  					
	  					var trovato = false;

	  					   /*LA SINTASSI E' LA SEGUENTE:
	  					   		PROVIDER|CUSTOMER|-1
	  					   		PEER|PEER|0
	  					   */
						   
						   /*PER QUESTO AVREMO 4 CASI DIVERSI:
						   		Non è detto che troveremo provider/customer oppure peer|peer in questo ordine. 
						   		Ad es 126 e 6939 sono due peer.
						   		Nel nostro db sono memorizzati in seguente modo 6939|126|0 invece che 126|6939|0.
						   		Quindi dobbiamo stare attenti perchè la posizione di 2 as in db potrebbe essere invertita.
						   		Perciò faremo 4 casi differenti.
						   */
						   
						   /*CASO 1 [AS1=AS2]: VEDIAMO SE SI TRATTA DI UN PEER IN ORDINE AS1|AS2|0*/

						   if ((data.indexOf(aspath[i]+"|"+aspath[i+1]+"|"+"0") !== -1)&&(!trovato)) {
								var verifybs = data.indexOf(aspath[i]+"|"+aspath[i+1]+"|"+"0"); //restituisce int (posizione)
							   	if(data.charAt(verifybs-1).trim() == ''){ //verifica se non ci sono altri numeri che precedono aspath
							   		console.log(aspath[i]+" = "+aspath[i+1]);


									/*PERCHé NON FUNZIONA?????*/
							   		item = {};
							   		item["asn"]=aspath[i+1];
							  		item["x"]=i+1;
									item["y"]=height;
							   		aspathcompleto.push(item);
							
							   		trovato = true;
						   		}
						   }
						 
						    /*CASO 2 [AS1<AS2]: VEDIAMO SE SI TRATTA DI UN PROVIDER/CUSTOMER TRA AS1|AS2|-1*/

						   	if ((data.indexOf(aspath[i]+"|"+aspath[i+1]+"|"+"-1") !== -1)&&(!trovato)){
						   		var verifybs2 = data.indexOf(aspath[i]+"|"+aspath[i+1]+"|"+"-1");
						   		if(data.charAt(verifybs2-1).trim() == ''){
						   	 		console.log(aspath[i]+" < "+aspath[i+1]);

									/*CREAZIONE DI UN OGGETTO JSON AS 
									CHE VERRA' AGGIUNTO ALLA LISTA DI OGGETTI JSON CHIAMATA ASPATHCOMPLETO*/
							   		item = {};
							   		item["asn"]=aspath[i+1];
							  		item["x"]=i+1;
									item["y"]=height-1;
									height = height -1;
							   		aspathcompleto.push(item);
							   		
						   	 		trovato = true;
						   		}
						   }

						    /*CASO 3 [AS2=AS1]: VEDIAMO SE SI TRATTA DI UN PEER|PEER TRA AS2|AS1|0*/
						   
						   	if ((data.indexOf(aspath[i+1]+"|"+aspath[i]+"|"+"0") !== -1)&&(!trovato)){
							   	var verifybs3 = data.indexOf(aspath[i+1]+"|"+aspath[i]+"|"+"0");
							   	if(data.charAt(verifybs3-1).trim() == ''){
							   		console.log(aspath[i]+" = "+aspath[i+1]);
							   		trovato = true;

									/*CREAZIONE DI UN OGGETTO JSON AS 
									CHE VERRA' AGGIUNTO ALLA LISTA DI OGGETTI JSON CHIAMATA ASPATHCOMPLETO*/
							   		item = {};
							   		item["asn"]=aspath[i+1];
							  		item["x"]=i+1;
									item["y"]=height;
							   		aspathcompleto.push(item);

							   		console.log(aspathcompleto);
									/*PERCHé NON FUNZIONA?????*/
						

							   	}
						   }

						    /*CASO 4 [AS2>AS1]: VEDIAMO SE SI TRATTA DI UN CUSTOMER|PROVIDER TRA AS2|AS1|-1*/

						    if ((data.indexOf(aspath[i+1]+"|"+aspath[i]+"|"+"-1") !== -1)&&(!trovato)){
							   	var verifybs4 = data.indexOf(aspath[i+1]+"|"+aspath[i]+"|"+"-1");
							   	if(data.charAt(verifybs4-1).trim() == ''){
							   		console.log(aspath[i]+" > "+aspath[i+1]);


									/*CREAZIONE DI UN OGGETTO JSON AS 
									CHE VERRA' AGGIUNTO ALLA LISTA DI OGGETTI JSON CHIAMATA ASPATHCOMPLETO*/
							   		item = {};
							   		item["asn"]=aspath[i+1];
							  		item["x"]=i+1;
									item["y"]=height+1;
									height = height+1;
							   		aspathcompleto.push(item);

							   		trovato = true;
							   	}
							   }

						  if (((data.indexOf(aspath[i]+"|"+aspath[i+1]) == -1) || (data.indexOf(aspath[i]+"|"+aspath[i+1]) != -1))&&(!trovato)){
						   		console.log(aspath[i] +" ? "+ aspath[i+1] +" It's NOT found :(");


									/*CREAZIONE DI UN OGGETTO JSON AS 
									CHE VERRA' AGGIUNTO ALLA LISTA DI OGGETTI JSON CHIAMATA ASPATHCOMPLETO*/
							   		item = {};
							   		item["asn"]=aspath[i+1];
							  		item["x"]=i+1;
									item["y"]=height;
									height = height;
							   		aspathcompleto.push(item);


						   	}

					}






  					var count = Object.keys(aspathcompleto).length;

					console.log(aspathcompleto);


					drawingpart(aspathcompleto);



					function drawingpart(aspathcompleto){

						var dataset = aspathcompleto;

						// 2. Use the margin convention practice 
						var margin = {top: 50, right: 50, bottom: 50, left: 50}
						  , width = window.innerWidth - margin.left - margin.right // Use the window's width 
						  , height = window.innerHeight - margin.top - margin.bottom; // Use the window's height

						// The number of datapoints
						var n = Object.keys(aspath).length;

						// 5. X scale will use the index of our data
						var xScale = d3.scaleLinear()
						    .domain(d3.extent(dataset, function(d) { return d.x; }))
						  // .domain([0, n]) // input
						    .range([0, width]); // output

						// 6. Y scale will use the randomly generate number 
						var yScale = d3.scaleLinear()
							.domain(d3.extent(dataset, function(d) { return d.y; }))
						   //.domain([0, n]) // input 
						    .range([height, 0]); // output 


						//var xScale = d3.extent(aspathcompleto, function(d) { return d.x; }),
            			//yScale = d3.extent(aspathcompleto, function(d) { return d.y; });

						// 7. d3's line generator
						var line = d3.line()
						    .x(function(d, i) { return xScale(i); }) // set the x values for the line generator
						    .y(function(d) { return yScale(d.y); }) // set the y values for the line generator 
						    .curve(d3.curveMonotoneX) // apply smoothing to the line

						// 8. An array of objects of length N. Each object has key -> value pair, the key being "y" and the value is a random number

						// 1. Add the SVG to the page and employ #2
						var svg = d3.select("body").append("svg")
						    .attr("width", width + margin.left + margin.right)
						    .attr("height", height + margin.top + margin.bottom)
						  .append("g")
						    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

						// 3. Call the x axis in a group tag
						svg.append("g")
						    .attr("class", "x axis")
						    .attr("transform", "translate(0," + height + ")")
						    .call(d3.axisBottom(xScale)); // Create an axis component with d3.axisBottom

						// 4. Call the y axis in a group tag
						svg.append("g")
						    .attr("class", "y axis")
						    .call(d3.axisLeft(yScale)); // Create an axis component with d3.axisLeft

						// 9. Append the path, bind the data, and call the line generator 
						svg.append("path")
						    .datum(dataset) // 10. Binds data to the line 
						    .attr("class", "line") // Assign a class for styling 
						    .attr("d", line); // 11. Calls the line generator 

						// 12. Appends a circle for each datapoint 
						svg.selectAll(".dot")
						    .data(dataset)
						  .enter().append("circle") // Uses the enter().append() method
						    .attr("class", "dot") // Assign a class for styling
						    .attr("cx", function(d, i) { return xScale(i) })
						    .attr("cy", function(d) { return yScale(d.y) })
						    .attr("r", 10)
						      .on("mouseover", function(a, b, c) { 
						  			console.log(a) 
						        this.attr('class', 'focus')
								})
						      .on("mouseout", function() {  })
						//       .on("mousemove", mousemove);

						//   var focus = svg.append("g")
						//       .attr("class", "focus")
						//       .style("display", "none");

						//   focus.append("circle")
						//       .attr("r", 4.5);

						//   focus.append("text")
						//       .attr("x", 9)
						//       .attr("dy", ".35em");

						//   svg.append("rect")
						//       .attr("class", "overlay")
						//       .attr("width", width)
						//       .attr("height", height)
						//       .on("mouseover", function() { focus.style("display", null); })
						//       .on("mouseout", function() { focus.style("display", "none"); })
						//       .on("mousemove", mousemove);
						  
						//   function mousemove() {
						//     var x0 = x.invert(d3.mouse(this)[0]),
						//         i = bisectDate(data, x0, 1),
						//         d0 = data[i - 1],
						//         d1 = data[i],
						//         d = x0 - d0.date > d1.date - x0 ? d1 : d0;
						//     focus.attr("transform", "translate(" + x(d.date) + "," + y(d.close) + ")");
						//     focus.select("text").text(d);
						//   }
					}

					}, 'text');
}



				

</script> 
